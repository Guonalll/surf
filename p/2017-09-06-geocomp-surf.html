<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="author" content="Nick Malleson">
        <meta name="keywords" content="ABM, dynamic data assimilation, EnKF, ensemble kalman filter">

		<title>Simulating Urban Flows</title>

		<link rel="stylesheet" href="reveal/css/reveal.css">
		<link rel="stylesheet" href="reveal/css/theme/white.css">
        
        <!-- Some extra bits added by Nick -->
        <link rel="stylesheet" href="reveal/css/nick.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="reveal/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal/css/print/pdf.css' : 'reveal/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
                
                <!--
                <section data-markdown id="index"
                         data-background-image="http://surf.leeds.ac.uk/figures/cityscapes/chicago_bw.jpg">
                -->
                    
                <section class="title"  id="index">
                    
                    <h1 style="font-size: 60px;">Simulating Urban Flows</h1>
                    <hr/>
                    <h2 style="font-size: 40px;"><a href="http://www.geog.leeds.ac.uk/people/n.malleson/">Nick Malleson</a>, Andy Evans, &amp; Jon Ward</h2>
                    <h4>Schools of Geography &amp; Mathematics, University of Leeds</h4>
                    <h4><a href="http://nickmalleson.co.uk">nickmalleson.co.uk</a></h4>
                    <h4><a href="http://surf.leeds.ac.uk">surf.leeds.ac.uk</a></h4>
                    <p style="text-align:center">These slides: <a href="http://surf.leeds.ac.uk/presentations.html">http://surf.leeds.ac.uk/presentations.html</a></p>
                </section>
                
                
                                
                <section data-background-video="../videos/trafalgar_timelapse-1280×720.mp4"
                         data-background-video-loop="loop"
                         id="Context-UrbanFlows">                     
                     
                    <div class="whitebackground2 fragment">
                        <h3>How many people are there in Traffalgar Square right now?</h3>
                        
                        <p>We need to quantify the ambient population and better understand
                        urban flows:</p>
                        
                        <p class="l2">Crime – how many possible victims?</p>
                        <p class="l2">Pollution – who is being exposed? Where are the hotspots?</p>
                        <p class="l2">Economy – can we attract more people to our city centre?</p>
                        <p class="l2">Health - can we encourage more active travel?</p>
                        
                    <p>Simulating Urban Flows (surf) - 3 year research project funded by the ESRC</p>
                    </div>
                </section>
                

                <section id="Overview" data-background-image="../figures/people_in_street.jpg">
                    <div class="whitebackground2">
                        <h2>Overview</h2>
                        
                        <p>Leeds Institute for Data Analytics (LIDA)</p>
                        <p class="l2">Urban Analytics research stream - very broad!</p>
                        <p class="l2">Focus on population flows and the ambient population</p>
                        <p>Machine learning approaches</p>
                        <p>Tracking people (HABITS)</p>
                        <p>Towards a real-time city simulation ... </p>
                        <p class="l2">Data assimilation</p>
                        <p class="l2">Agent-Based modelling</p>
                        
                    </div>
                </section>

                



                
                
                  <!-- *
                     *
                     *
                     Using machine learning to model footfall
                     *
                     *
                -->
                
                <section id="MachineLearningFootfall">
                    
                    <h2>Modelling Footfall with Machine Learning</h2>
                    <p>Aim: to better understand footfall in Leeds city centre, using computer models and footfall camera data</p>
                    <p>Methods</p>
                    <p class="l2">Data analysis &amp; visualisation</p>
                    <p class="l2">Machine learning</p>
                    <p>Outcomes</p>                    
                    <p class="l2">Analysis of changes in footfall patterns over time</p>
                    <p class="l2">A model of footfall, able to quantify the success of events</p>
                    <p class="l2">Indications of most important drivers</p>

                </section>
                
                
                <section id="MLFootfall-data">
                    
                    <h2>Modelling Footfall with Machine Learning</h2>
                    <figure class="right">
                        <img data-src="../figures/lcc-footfall/camera_locations.png", alt="Locations of CCTV cameras"/>
                        <figcaption>Locations of the footfall cameras in Leeds</figcaption>
                    </figure>
                    <p>Aim: to better understand footfall in Leeds city centre, using computer models and footfall camera data</p>
                    
                    <p>8 cameras installed between 2007 and 2009</p>
                    <p>Track movement of people through their field of vision</p>
                    <p>Provide counts of number of passers-by per hour</p>
                    <p>Cover a relatively small area of the city centre, not
                    good for wider dynamics.</p>
                    
                
                </section>
                
                <!--
                <section id="MLFootfall-calendar">
                    <img data-src="../figures/lcc-footfall/calendar.png", 
                         alt="Calendar showing footfall patterns over a typical week "/>
                
                </section>
                
                <section id="MLFootfall-temporal_variation">
                    
                    <h2>Modelling Footfall with ML</h2>
                    <h3>Side note: Temporal Change</h3>
                    <p>Saw an change in proportion of people using the city</p>
                    <p>Daytime (8am to 6pm) -> Evening (6pm to 9pm)</p>
                    <p>Night time (9pm to 8am) unchanged</p>
                    
                    <img data-src="../figures/lcc-footfall/footfall_proportions.png", 
                         alt="Change in proportions of people in the city at different times"/>
                
                </section>

                -->

                <section id="MLFootfall-explanatory_data">
                    
                    <h2>Modelling Footfall with ML</h2>
                    <img class="right" data-src="../figures/lcc-footfall/people_in_the_rain.png"
                         alt="People in the rain" />
                    <h3>Explanatory factors</h3>
                    <p>Bank Holidays</p>
                    <p class="l2">What type of bank holiday?</p>
                    <p>School and University Holidays</p>
                    <p>The weather</p>
                    <p class="l2">Mean temperature, wind speed and rainfall</p>
                    <p>Day of week</p>
                    <p>Many others (not tested yet...)</p>
                    <p class="l2">Train prices, car parking availability, business
                    opening times, etc.</p>
                    
                </section>
                
                <section id="MLFootfall-machine_learning">
                    
                    <h2>Modelling Footfall with ML</h2>
                    <img class="right" data-src="../figures/lcc-footfall/model_error.png" 
                         alt="Errors from the random forest model" />
                
                    <h3>Machine Learning Methods</h3>
                    <p>LIDA Intern - Molly Asher</p>
                    <p class="l2">Ended up supervising me  ... </p>
                    <p>Attempted a number of different methods</p>
                    <p class="l2">Mainly neural networks and random forests</p>
                    <p class="l2">Random forest was most accurate</p>
                    
                </section>
                
                <section id="MLFootfall-feature_importance">
                    
                    <h2>Modelling Footfall with ML</h2>
                    <h3>Feature Importance</h3>
                    <div style="font-size:70%">
                    <table>
                        <thead>
                            <tr><th>Variable</th><th>Relative Importance</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Mean daily temperature</td><td>1142</td></tr>
                            <tr><td>Mean daily rainfall</td><td> 383 </td></tr>
                            <tr><td>Monday</td><td>131</td></tr>
                            <tr><td>2013</td><td>131</td></tr>
                            <tr><td>Saturday</td><td>130</td></tr>
                            <tr><td>2016</td><td>130</td></tr>
                            <tr><td>After Trinity opened</td><td>123</td></tr>
                            <tr><td>Thursday</td><td>122</td></tr>
                            <tr><td>Tuesday</td><td>116</td></tr>
                            <tr><td>School holiday</td><td>115</td></tr>
                        </tbody>
                    </table>
                </div>
                </section>
                
                
                <section id="MLFootfall-predictive_analytics">
                    
                    <h2>Modelling Footfall with ML</h2>
                    <h3>Predictive Analytics</h3>
                    <div style="font-size:70%">
                    <table>
                        <thead>
                            <tr><th>Event</th><th>Date</th><th>Real Footfall</th><th>Prediction</th><th>Difference (%)</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Tour de France</td><td>5-Jul-14</td><td>346,180</td><td>217,277</td><td>-37</td></tr>
                            <tr><td>Trinity Opening</td><td>21-Mar-13</td><td>279,473</td><td>187,381</td><td>-33</td></tr>
                            <tr><td>Xmas lights 2013</td><td>07-Nov-13</td><td>193,441</td><td>153,750</td><td>-21</td></tr>
                            <tr><td>Xmas lights 2015</td><td>12-Nov-15</td><td>175,126</td><td>160,105</td><td>-9</td></tr><tr>
                            <tr><td>Light Night</td><td>06-Oct-16</td><td>225,660</td><td>198,025</td><td>-12</td></tr>
                            
                            <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                            
                            <tr><td>???</td><td>30-Dec-12</td><td>106,423</td><td>157,842</td><td>+48</td></tr>
                            <tr><td>???</td><td>12-Apr-16</td><td>134,808</td><td>173,734</td><td>+29</td></tr>
                            
                        </tbody>
                    </table>
                </div>
                
                </section>
                
           
                <section id="MLFootfall-conclusions">
                    
                    <h2>Modelling Footfall with ML</h2>
                    <h3>Conclusion</h3>
                    
                    <p>Still needs some refinement, but potentially a useful tool</p>
                    <p>There are caveats, and it's not so useful for more nuanced analysis</p>
                    <p class="l2">Easy to overfit - e.g. train with 365 days</p>
                    <p class="l2">Not generalisable (<i>after trinity opened</i>)</p>
                    <p class="l2">What about bank holidays that fall during other holidays?</p>
                    <p class="l2">How should roads be re-configured to encourage pedestrians?</p>
                    <p class="l2">Where are most visitors coming from?</p>
                    <p class="l2">How have patterns of use in the city changed?</p>
                    <p>For this we need more detail about individual movements...</p>
                
                </section>
                
                  <!-- *
                     *
                     *
                     HABITS
                     *
                     *
                -->
                
                <section id="HABITS">
                    
                    <div style="text-align: left">
                        <a href="http://habitsdata.org/">
                            <img data-src="../figures/habits/habits_logo.png" alt="HABITS"
                             style="align:left; width:300px; height:auto;" />
                        </a>
                    </div>
                    
                    <h3>Improved policy to mitigate pollutant and inactivity related health burdens
                    through new big data</h3>
                    
                    <p>Aim: Take new 'Track and Trace' (T&amp;T) data generated from mobile phones to
                        support new policies to:</p>
                    <p class="l2">Reduce the disease burden of pollution</p>
                    <p class="l2">Encourage active travel</p>
                    <p>Lead by the Institute for Transport Studies, in collaboration with
                        Newcastle City Council and funded by the ESRC</p>                    
                    <p>A more nuanced measure of population flows?</p>
                    
                </section>
                
                <section id="HABITS-GoSmarter">
                    <div style="text-align: left">
                        <a href="http://habitsdata.org/">
                            <img data-src="../figures/habits/habits_logo.png" alt="HABITS"
                             style="align:left; width:300px; height:auto;" />
                        </a>
                    </div>
                    <img style="float:right; width:300px; height:auto"
                         src="../figures/habits/go_smarter_logo.png" alt ="GoSmarter logo" />
                    <h3>Go Smarter</h3>
                    <p>Smart-phone app built in collaboration with Newcastle City Council</p>
                    <p>Tracks peoples' journeys</p>
                    <p class="l2">Detects when the user is moving and estimates mode of travel</p>
                    <p>Rewards for using active / sustainable modes of travel</p>
                    <p>Aim: Demonstrate how the linking of high-resolution location data
                        and other databases / models can support better policy making</p>
                </section>
                
                
                <section id="HABITS-Pollution">
                    
                     <figure class="right">
                        <img data-src="../figures/attribution/park-aag-pollution.png" />
                        <figcaption>
                            Source: Park, Yoo Min, and Mei-Po Kwan (2017). Individual Exposure Estimates May Be Erroneous When Spatiotemporal Variability of Air Pollution and Human Mobility Are Ignored. <i>Health &amp; Place</i> 43: 85–94.
                        </figcaption>
                    </figure>
                    
                    <div style="text-align: left">
                        <a href="http://habitsdata.org/">
                            <img data-src="../figures/habits/habits_logo.png" alt="HABITS"
                             style="align:left; width:300px; height:auto;" />
                        </a>
                    </div>
                    
                    <h3>Disease Burden of Pollution</h3>
                    
                   <p>Collaborating with the Newcastle <a href="http://www.urbanobservatory.ac.uk/">
                       Urban Observatory</a> who are sensing the urban environment</p>
                    <p>Aim: use T&amp;T data to model urban flows and identify the most
                    serious pollution hotspots.</p>
                    
                </section>
                
                <section id="HABITS-Caveats">
                    <figure class="right">
                        <img data-src="../figures/attribution/park-aag-pollution.png" />
                        <figcaption>
                            Source: Park, Yoo Min, and Mei-Po Kwan (2017). Individual Exposure Estimates May Be Erroneous When Spatiotemporal Variability of Air Pollution and Human Mobility Are Ignored. <i>Health &amp; Place</i> 43: 85–94.
                        </figcaption>
                    </figure>
                    <div style="text-align: left">
                        <a href="http://habitsdata.org/">
                            <img data-src="../figures/habits/habits_logo.png" alt="HABITS"
                             style="align:left; width:300px; height:auto;" />
                        </a>
                    </div>
                    <h3>Data Caveats</h3>
                    <p>T&amp;T data are</p>
                    <p class="l2">High resolution (spatio-temporal)</p>
                    <p class="l2">Abundant</p>
                    <p>BUT:</p>
                    <p class="l2">How representative of the wider population?</p>
                    <p class="l2">Abundant <i>enough?</i></p>
                </section>
                
                
         
                
                <!-- *
                     *
                     *
                     ABM for urban flows (surf)
                     *
                     *
                -->
                
            
                <section id="abm-triumvant1"
                         data-background-image="../figures/virtual_city.jpeg">
                
                    <div class="whitebackground2">
                        <h2>Three pillars for modelling &amp; forecasting in urban areas</h2>
                        <p>Big Data</p>
                        <p>Smart Cities</p>
                        <p>ABM?</p>
                    </div>
                    
                </section>
                
                <section id="abm-triumvant2">
                    <img src="../figures/paper_figures/triumvirate.png" />
                </section>


                <section id="problems1">
                    <h2>ABM as </h2>
                    <h3>ABM Problems</h3>
                    <p>1. Computationally Expensive</p>
                    <p class="l2">Not amenable to machine-led calibration</p>
                    <p>2. Data hungry</p>
                    <p class="l2">Need fine-grained information about individual actions and behaviours</p>
                    <p>3. Divergent</p>
                    <p class="l2">Usually models represent complex systems</p>
                    <p class="l2">Projections / forecasts quickly diverge from reality</p>
                </section>
                
                
                <section id="prob-divergence" 
                         data-background-video="../videos/BBC_Swarm_Natures_Incredible_Invasions.mp4" 
                         data-background-video-muted 
                         data-background-video-loop="loop">
                    
                    <div class="whitebackground fragment">
                        <h2>3. Divergence</h2>
                        <p>Complex systems</p>
                        <p>One-shot calibration</p>
                        <p>Nonlinear models predict near future well, but diverge over time.</p>
                    </div>
                </section>
                
                <section id="abm-calibration">
                    
                    <figure class="right" style="width:30%">
                        <img data-src="../figures/modelling_process.png" alt="The process of calibration"/>
                        <figcaption>Typical model development process</figcaption>
                    </figure>
                    
                    <h2>3. Divergence</h2>
                    <p>Drawback with the 'typical' model development process</p>
                    <p>Waterfall-style approach is common</p>
                    <p>Calibrate until fitness is reasonable, then make predictions</p>
                    <p>But we can do better:</p>
                    <p class="l2">Better computers</p>
                    <p class="l2">More (streaming) data</p>
                    <p>Methodological gap</p>
                    
                </section>
                
                
                <!-- *
                     *
                     *
                     Data Assimilation
                     *
                     *
                -->
                
                
                <section id="abm-dda-overview">
                    <img data-src="../figures/paper_figures/dda.jpg" alt="Diagram of dynamic data assimilation and an ABM" />
                </section>
                
                
                            
                <section id="dda" data-background-image="../figures/weather2.jpg" >
                    <div class="whitebackground fragment">                    
                        <h2>Dynamic Data Assimilation</h2>
                        <p>Used in meteorology and hydrology to constrain models closer to reality.</p>
                        <p>Try to improve estimates of the true system state by combining:</p>
                        <p class="l2">Noisy, real-world observations</p>
                        <p class="l2">Model estimates of the system state</p>
                        <p>Should be more accurate than data / observations in isolation.</p>
                    </div>
                </section>
                

                
                <section id="enfk-process1">
                    <h2>Ensemble Kalman Filter - Basic Process</h2>
                    <p>1. Forecast.</p>
                    <p class="l2">Run an ensemble of models (ABMs) forward in time.</p>
                    <p class="l2">Calculate ensemble mean and variance</p>
                    <p>2. Analysis.</p>
                    <p class="l2">New 'real' data are available</p>
                    <p class="l2">Integrate these data with the model forecasts to create estimate of model parameter(s)</p>
                    <p class="l2">Impact of new observations depends on their accuracy</p>
                    <p>3. Repeat</p>
                    
                </section>
                <section id="enfk-process2">
                    <h2>Ensemble Kalman Filter - Basic Process</h2>
                    <img data-src="../figures/paper_figures/time_framework.png" alt="Diagram of DDA assimilating data" />
                </section>
                
                <section id="enkf-experiment1" >
                    <h2>Experiment with an EnFK</h2>
                    <p>Very simple ABM</p>
                    <p class="l2">People walking along a street</p>
                    <p class="l2">Every hour, <i>x</i> people begin at point A</p>
                    <p class="l2">CCTV Cameras at either end count footfall</p>
                    <p class="l2">Some people can leave before they reach the end (<i>bleedout rate</i>)</p>
                    <p>Aim: Estimate the number of people who will pass camera B</p>
                    <img style="width:70%;" data-src="../figures/paper_figures/dda_model_environment.jpg" alt="Diagram of the model environment" />                
                </section>
                
                
                <section id="enkf-truth_data">
                    <h2>Hypothetical 'Truth' Data</h2>
                    <p>Use the model to first generate a hypothetical reality</p>
                    <img style="Width:70%;" data-src="../figures/paper_figures/example_flow.png" alt="Results - counts at camera A and B" />
                </section>

                <section id="results">
                    
                    <h2>(Preliminary) Experimental Results</h2>
                    
                    <figure style="width:43%;" class="left">
                        <img data-src="../figures/paper_figures/kalman_filter_results.png" alt="Results1 (see caption)" />
                        <figcaption>Kalman filter results over 5 days</figcaption>
                    </figure>
                    
                    <figure style="width:43%;" class="right">
                        <img data-src="../figures/paper_figures/sequential_parameter_estimation.png" alt="Results1 (see caption)" />
                        <figcaption>Sequential parameter estimation under increased observational uncertainty</figcaption>
                    </figure>
                
                </section>
                
                <section id="results2">
                    <h2>(Preliminary) Experimental Results</h2>
                    <p>Forecast and analysis are barely distinguishable</p>
                    <p>Virtual observations are closer to 'truth' than the analysis :-(</p>
                    <p class="l2">This is probably due to the degree of randomness in the model</p>
                    <p>EnKF estimates the model parameter (<i>bleedout rate</i>) accurately :-)</p>
                </section>
                
                

                
                
                
                                
                <!-- *
                     *
                     *
                     Towards real-time city simulation
                     *
                     *
                -->
                
                <section id="city-simulation" 
                         data-background-video="../videos/skylines_mov.mp4" 
                         data-background-video-muted 
                         data-background-video-loop="loop">
                    
                    <div class="whitebackground2 fragment">
                        <h2>Simulating Urban Flows (surf)</h2>
                        <p><a href="http://surf.leeds.ac.uk/">surf.leeds.ac.uk</a></p>
                        <p>Aim: Create an agent-based model capable of representing
                        the human flows in a real city.</p>
                        <p>Calibrated using streaming data <i>dynamically</i></p>
                        <p>Hoping for European Research Council funding to continue the work</p>
                    </div>
                </section>
                
                

                                
                

                <!-- *
                     *
                     *
                     Conclusion
                     *
                     *
                -->

                
                <section id="conclusion" data-background-image="../figures/people_in_street.jpg">
                    <div class="whitebackground2">
                        <h2>Conclusion</h2>
                        <p>Some work from the Simulating Urban Flows project</p>
                        <p class="l2">Machine learning approaches</p>
                        <p class="l2">Tracking people (HABITS)</p>
                        <p class="l2">Dynamically calibdated ABMs</p>
                        <p>Towards a real-time city simulation ... </p>
                    </div>
                </section>                
                
                
                <section class="title"  id="final">
                    
                    <h3>Simulating Urban Flows</h3>
                    <hr/>
                    <h2 style="font-size: 40px;"><a href="http://www.geog.leeds.ac.uk/people/n.malleson/">Nick Malleson</a>, Andy Evans, &amp; Jon Ward</h2>
                    <h4>Schools of Geography &amp; Mathematics, University of Leeds</h4>
                    <h4><a href="http://nickmalleson.co.uk">nickmalleson.co.uk</a></h4>
                    <h4><a href="http://surf.leeds.ac.uk">surf.leeds.ac.uk</a></h4>
                    <p style="text-align:center">These slides: <a href="http://surf.leeds.ac.uk/presentations.html">http://surf.leeds.ac.uk/presentations.html</a></p>
                    
                </section>    
                

                
			</div>
		</div>

		<script src="reveal/lib/js/head.min.js"></script>
		<script src="reveal/js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'reveal/plugin/markdown/marked.js' },
					{ src: 'reveal/plugin/markdown/markdown.js' },
					{ src: 'reveal/plugin/notes/notes.js', async: true },
					{ src: 'reveal/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
