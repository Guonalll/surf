<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="author" content="Nick Malleson">
        <meta name="keywords" content="ABM, dynamic data assimilation, EnKF, ensemble kalman filter">

		<title>Forecasting Short-Term Urban Dynamics: Data Assimilation for Agent-Based Modelling</title>

		<link rel="stylesheet" href="reveal/css/reveal.css">
		<link rel="stylesheet" href="reveal/css/theme/white.css">
        
        <!-- Some extra bits added by Nick -->
        <link rel="stylesheet" href="reveal/css/nick.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="reveal/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal/css/print/pdf.css' : 'reveal/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
                
                <!--
                <section data-markdown id="index"
                         data-background-image="http://surf.leeds.ac.uk/figures/cityscapes/chicago_bw.jpg">
                -->
                    
                <section class="title"  id="index">
                    
                    <h1 style="font-size: 60px;">Forecasting Short-Term Urban Dynamics: Data Assimilation for Agent-Based Modelling</h1>
                    <hr/>
                    <h2 style="font-size: 40px;"><a href="http://www.geog.leeds.ac.uk/people/n.malleson/">Nick Malleson</a>, 
                        Tomas Crols, Jon Ward, Andrew Evans</h2>
                    <h4>Schools of Geography &amp; Mathematics, University of Leeds, UK</h4>
                    <h4><a href="http://nickmalleson.co.uk">nickmalleson.co.uk</a></h4>
                    <h4><a href="http://surf.leeds.ac.uk">surf.leeds.ac.uk</a></h4>
                    <h4><a href="http://dust.leeds.ac.uk">dust.leeds.ac.uk</a></h4>
                    <hr/>
                    <p style="text-align:center;font-size:25px">These slides: <a href="http://surf.leeds.ac.uk/presentations.html">http://surf.leeds.ac.uk/presentations.html</a></p>
                    <p style="text-align:center;font-size:25px">Code: <a href="https://github.com/nickmalleson/surf/tree/master/abm/essa-kalman_filter">https://github.com/nickmalleson/surf</a></p>
                </section>    

                <section id="abstract" >

                	
                	<h2>Abstract</h2>
                	
                    <p class="small">The 'data deluge', coupled with related 'smart cities' initiatives, have led to a proliferation of models that capture the current state of urban systems to a high degree of accuracy. However, they are typically 'black box' in nature, which makes it difficult to use them to better understand the fundamental dynamics that drive the systems under study. Furthermore, many example models of 'smart cities' appear limited in their ability to *forecast* future system states. Agent-based modelling (ABM) is well suited to modelling urban systems, but is limited in its ability to incorporate up-to-date data as they arise in order to reduce uncertainty in model forecasts. This limits the usefulness of ABM a forecasting tool. This paper presents ongoing work that adapts data assimilation techniques from fields such as meteorology (specifically the 'ensmble Kalman Filter') in order to allow agent-based models to be optimised using streaming data in real time. Here, a simple example of an agent-based model used to simulate the movement of people as they travel along a street is illustrated. Importantly, the model is optimised dynamically in response to hypothetical data streams. The paper will also demonstrate some important secondary uses of the technique as a means of capturing model uncertainty. Ultimately, we work towards a combination of ABM and data assimilation methods that will be able to assimilate streaming ‘smart cities’ data into models in real time. </p>

                </section>
                
                <section data-background-video="../videos/trafalgar_timelapse-1280×720.mp4"
                         data-background-video-loop="loop"
                         id="Context-UrbanFlows">                     
                    <div class="whitebackground2 fragment">
                        <h3>How many people are there in Trafalgar Square right now?</h3>
                        
                        <p>We need to better understand urban flows:</p>
                        
                        <p class="l2">Crime – how many possible victims?</p>
                        <p class="l2">Pollution – who is being exposed? Where are the hotspots?</p>
                        <p class="l2">Economy – can we attract more people to our city centre?</p>
                        <p class="l2">Health - can we encourage more active travel?</p>
                        <p>Achieve this through agent-based modelling?</p>
                        
                    </div>
                </section>
                
                <section>
                    <h2>Results</h2>
                    <p>&nbsp;</p>
                    <p>&nbsp;</p>
                    <p>&nbsp;</p>
                    <p>&nbsp;</p>
                    <p>&nbsp;</p>
                </section>

                
                <section id="current_research1">
                    
                    <h2>Agent-Based Urban Modelling</h2>
                    <a href="https://esrc.ukri.org/">
                        <img class="right" style="width:200px;" src="../figures/LOGO_ESRC.jpg" alt="ESRC Logo"/></a>
                    <h3>Current Research</h3>
                    <p>Simulating Urban Flows (<a href="http://surf.leeds.ac.uk">surf</a>)</p>                    
                    <p class="l2">3 year research project funded by the UK ESRC</p>
                    <p class="l2">One of the aims: <strong>calibrate an urban ABM using streaming data</strong></p>
                    <p class="l2">Turns out this is really hard!</p>            
                </section>
                
                <section id="current_research2-dust" data-background-image="https://erc.europa.eu/sites/default/files/content/pages/images/DUST_illustration_copyright-Shutterstock.jpg">
                    <div class="whitebackground2">
                        <h2>Agent-Based Urban Modelling</h2>
                        <a href="https://erc.europa.eu/">
                            <img class="right" style="width:200px;" src="../figures/LOGO_ERC.jpg" alt="ESRC Logo"/></a>
                        <p>New project: <strong>Data Assimilation for Agent-Based Models</strong> (<a href="http://dust.leeds.ac.uk">dust</a>)</p>
                        <p class="l2">5-year research project</p>
                        <p class="l2">Funded by the European Research Council (Starting Grant)</p>
                        <p class="l2">Started in January</p>
                        <p>Main aim: create a new method for dynamically assimilating data into agent-based models.</p>
                    </div>
                
                </section>
                
                
                              
                <section id="Overview" data-background-image="../figures/people_in_street.jpg">
                    <div class="whitebackground2">
                        <h2>Overview</h2>

                        <p>ABM for a geographical simulation of urban flows</p>
                        <p class="l2">Major hurdle: <i>real time</i> calibration</p>
                        <p>Dynamic data assimilation for ABM</p>
                        <p class="l2">with an <i>ensemble Kalman filter</i> (EnKF)</p>
                        <p>Towards a real-time city simulation</p>
                        <hr/>
                        <p>Help and advice please!</p>
                    </div>
                </section>

                
                
                
                <section id="prob-divergence" 
                         data-background-video="../videos/BBC_Swarm_Natures_Incredible_Invasions.mp4" 
                         data-background-video-muted 
                         data-background-video-loop="loop">
                    
                    <div class="whitebackground fragment">
                        <h2>3. Divergence</h2>
                        <p>Complex systems</p>
                        <p>One-shot calibration</p>
                        <p>Nonlinear models predict near future well, but diverge over time.</p>
                    </div>
                </section>
                
                <section id="abm-calibration">
                    
                    <figure class="right" style="width:30%">
                        <img data-src="../figures/modelling_process.png" alt="The process of calibration"/>
                        <figcaption>Typical model development process</figcaption>
                    </figure>
                    
                    <h2>3. Divergence</h2>
                    <p>Drawback with the 'typical' model development process</p>
                    <p>Waterfall-style approach is common</p>
                    <p>Calibrate until fitness is reasonable, then make predictions</p>
                    <p>But we can do better:</p>
                    <p class="l2">Better computers</p>
                    <p class="l2">More (streaming) data</p>
                    <p>Methodological gap</p>
                    
                </section>
                
            
                
                            
                <section id="dda" data-background-image="../figures/weather2.jpg" >
                    <div class="whitebackground fragment">
                        <h2>Dynamic Data Assimilation</h2>
                        <p>Used in meteorology and hydrology to constrain models closer to reality.</p>
                        <p>Try to improve estimates of the true system state by combining:</p>
                        <p class="l2">Noisy, real-world observations</p>
                        <p class="l2">Model estimates of the system state</p>
                        <p>Should be more accurate than data / observations in isolation.</p>
                    </div>
                </section>
                
                
                <section id="abm-dda-overview">
                    <img data-src="../figures/paper_figures/dda.jpg" alt="Diagram of dynamic data assimilation and an ABM" />
                </section>
                
                


                <section id="enkf">
                    <h2>DDA: How? </h2>
                    <h3>One example: Ensemble Kalman Filter (EnKF)</h3>
                    <p>Broad literature, but generally tied to mathematical models (e.g. differential equations and linear functions)</p>
                    <!--<p>Not applicable to ABM (inherently non-linear)</p>-->
                    <p>Working with a mathematician to do the hard work!</p>
                    <p class="l2">In all its glory: Ward et al., (2016)</p>
                    <h3>Advantages</h3>
                    <p>Similar to <i>Kalman Filter</i> (best in class)</p>
                    <p>But better for nonlinear systems</p>
                    
                </section>

                
                <section id="enfk-process1">
                    <h2>Ensemble Kalman Filter - Basic Process</h2>
                    <p>1. Forecast.</p>
                    <p class="l2">Run an ensemble of models (ABMs) forward in time.</p>
                    <p class="l2">Calculate ensemble mean and variance</p>
                    <p>2. Analysis.</p>
                    <p class="l2">New 'real' data are available</p>
                    <p class="l2">Integrate these data with the model forecasts to create estimate of model parameter(s)</p>
                    <p class="l2">Impact of new observations depends on their accuracy</p>
                    <p>3. Repeat</p>
                    
                </section>
                
                <section id="enkf-darsos_diagram">
                    
                    <h2>Ensemble Kalman Filter (EnKF)</h2>
                    <h3>Outline</h3>
                    <figure>
                        <img data-src="../figures/paper_figures/darsos-fig2a.png"/>
                        <figcaption>
                            Ward, J., A. Evans, N. Malleson (2016) Dynamic calibration of agent-based models using data assimilation. <i>Royal Society Open Science</i>. 3:150703. (open access). [DOI: <a href="https://dx.doi.org/10.1098/rsos.150703">10.1098/rsos.150703</a>]
                        </figcaption>
                    </figure>                
                </section>
                
                <!--
                <section id="enfk-process2">
                    <h2>Ensemble Kalman Filter - Basic Process</h2>
                    <img data-src="../figures/paper_figures/time_framework.png" alt="Diagram of DDA assimilating data" />
                </section>
                -->
                
                <section id="enkf-experiment1" >
                    <h2>Experiment with an EnKF</h2>
                    <p>Very simple ABM - people walking along a street</p>
                    <p class="l2">Every hour, <i>x</i> people begin at point A</p>
                    <p class="l2">CCTV Cameras at either end count footfall</p>
                    <p class="l2">Some people can leave before they reach the end (<i>bleedout rate</i>)</p>
                    <p class="l2">Complete model state can be captured in a state vector.</p>
                    <p>Aim: Estimate the number of people who will pass camera B</p>
                    <img style="width:80%;" data-src="../figures/paper_figures/dda_model_environment.jpg" alt="Diagram of the model environment" />                
                </section>
                
                
                <section id="enkf-truth_data">
                    <h2>Hypothetical 'Truth' Data</h2>
                    <p>Use the model to first generate a hypothetical reality</p>
                    <img style="Width:100%;" data-src="../figures/paper_figures/dda-essa/example_flow2.png" alt="Results - counts at camera A and B" />
                </section>

        
                <section id="results1">
                    
                    <h2>(Preliminary) Experimental Results</h2>
                    <h3>Summary</h3>
                    <p>Number of agents who pass camera B:</p>                
                    <figure style="width:100%;">
                        <img data-src="../figures/paper_figures/dda-essa/results_summary.png" alt="Results (see caption)" />
                        <figcaption>Number of agents who pass camera B measured using
                        the forecast, analysis, virtual observations, and truth data.
                        There is little to distinguish between the model states before and
                        after data assimilation.</figcaption>
                    </figure>
                    <p>In short: data assimilation only marginally changed the system state.</p>
                </section>
                
                
                <section id="results3">
                    
                    <h2>(Preliminary) Experimental Results</h2>
                    <h3>Parameter Estimation</h3>
                    <p>Model parameters can be included in the model state vector.</p>
                    <p>Can the EnKF find the single model parameter? (The <i>bleedout rate</i>).</p>                    
                    <figure style="width:100%;">
                        <img data-src="../figures/paper_figures/dda-essa/results-bleedout_rate.png" alt="Results (see caption)" />
                        <figcaption>How quickly the EnKF finds the model parameter (<i>bleedout rate</i>).
                        Happily it finds the 'true' parameter value reasonably quickly.</figcaption>
                    </figure>
                
                </section>
                
            
                
                <section id="resultsX">
                    <h2>(Preliminary) Experimental Results</h2>
                    <h3>Quantifying Error (RMSE)</h3>
                    <p>Forecast: 9.5; Analysis: 6.5; Observation: 3.0.</p>
                    <p>Surprising because we would expect Analysis &lt; Observation</p>
                    <p class="l2">Virtual observations are closer to 'truth' than the analysis :-(</p>
                    <p class="l2">This is probably due to the degree of randomness in the model - 
                    intelligent guesses will rarely be closer to reality than observations 
                        (even noisy observations).</p>
                    <p>EnKF estimates the model parameter (<i>bleedout rate</i>) accurately :-)</p>
                </section>
                


                
                <section id="conclusions1" data-background-image="https://erc.europa.eu/sites/default/files/content/pages/images/DUST_illustration_copyright-Shutterstock.jpg">
                    <div class="whitebackground2">
                        <h2>Conclusion and Outlook</h2>
                        <p>Surprising lack of smart cities <i>forecasting</i></p>
                        <p>ABM potentially able to combine 'big' data to make more reliable short-term predictions</p>
                        <p>Lots of work needed to adapt data assimilation techniques</p>
                        <p>Future: a holistic city model, estimating the current state <i>and</i> 
                        predicting future states.</p>
                    </div>
                </section>
                
                <section id="conclusions2" data-background-image="https://erc.europa.eu/sites/default/files/content/pages/images/DUST_illustration_copyright-Shutterstock.jpg">
                    <div class="whitebackground2">
                        <h2>Conclusion and Outlook</h2>
                        <p>Lots that we can borrow from the hard sciences</p>
                        <p>Emulators</p>
                        <p class="l2">Simplified versions of a computationally-expensive model that can 
                            be executed quickly</p>
                        <p class="l2">Good for exploring the parameter space</p>
                        <p>Uncertainty</p>
                        <p class="l2">Improved methods for quantifying and visualising uncertainty.</p>
                        <img src="../figures/paper_figures/dda-essa/ensemble_uncertainty.png" 
                             alt="Uncertainty in weather forecasts" />
                    </div>
                </section>
                
                
           
                
                
                <section id="references">
                    
                    <h2>References</h2>
                    
                    
                    <p>Bond, R., and Kanaan, A. (2015) MassDOT Real Time Traffic Management System. In Planning Support Systems and Smart Cities, S. Geertman, J. Ferreira, R. Goodspeed, and J. Stillwell, Eds. Springer International Publishing, pp. 471–488.</p>
                    
                    <p>Kitchin, R. (2013a). Big data and human geography Opportunities, challenges and risks. Dialogues in Human Geography, 3(3):262–267.</p>
                    
                    <p>Kitchin, R. (2013b). The Real-Time City? Big Data and Smart Urbanism. SSRN Electronic Journal.</p>
                    
                    <p>Mayer-Schonberger, V. and Cukier, K. (2013). Big Data: A Revolution That Will Transform How We Live, Work and Think. John Murray, London, UK</p>
                    
                    <p>Ward, Jonathan A., Andrew J. Evans, and Nicolas S. Malleson. 2016. Dynamic Calibration of Agent-Based Models Using Data Assimilation. <i>Open Science</i> 3 (4). doi:10.1098/rsos.150703.</p>
                    
                </section>
                
                <section class="title"  id="final">
                    
                    <h1 style="font-size: 60px;">Forecasting Short-Term Urban Dynamics: Data Assimilation for Agent-Based Modelling</h1>
                    <hr/>
                    <h2 style="font-size: 40px;"><a href="http://www.geog.leeds.ac.uk/people/n.malleson/">Nick Malleson</a>, 
                        Tomas Crols, Jon Ward, Andrew Evans</h2>
                    <h4>Schools of Geography &amp; Mathematics, University of Leeds, UK</h4>
                    <h4><a href="http://nickmalleson.co.uk">nickmalleson.co.uk</a></h4>
                    <h4><a href="http://surf.leeds.ac.uk">surf.leeds.ac.uk</a></h4>
                    <h4><a href="http://dust.leeds.ac.uk">dust.leeds.ac.uk</a></h4>
                    <hr/>
                    <p style="text-align:center;font-size:25px">These slides: <a href="http://surf.leeds.ac.uk/presentations.html">http://surf.leeds.ac.uk/presentations.html</a></p>
                    <p style="text-align:center;font-size:25px">Code: <a href="https://github.com/nickmalleson/surf/tree/master/abm/essa-kalman_filter">https://github.com/nickmalleson/surf</a></p>
                </section>    
                

                
			</div>
		</div>

		<script src="reveal/lib/js/head.min.js"></script>
		<script src="reveal/js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'reveal/plugin/markdown/marked.js' },
					{ src: 'reveal/plugin/markdown/markdown.js' },
					{ src: 'reveal/plugin/notes/notes.js', async: true },
					{ src: 'reveal/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
